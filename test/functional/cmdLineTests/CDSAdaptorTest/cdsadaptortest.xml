<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE suite SYSTEM "cmdlinetester.dtd">

<suite id="CDS Adaptor CommandLineOptionTests Suite">

	<variable name="CACHENAME" value="cdsadaptor_cache" />
	
	<variable name="XSHARECLASSES" value="-Xshareclasses:name=$CACHENAME$" />
	
	<!-- NOTE: Update the version of org.eclipse.osgi and com.ibm.cds bundles whenever new version are checked in -->
	<variable name="OSGI_CDS_JAR_PATH" value=".$CPDL$.$PATHSEP$org.eclipse.osgi_3.8.0.v20120123-1419.jar$CPDL$.$PATHSEP$FrameworkBundles$PATHSEP$com.ibm.cds_2.2.0.201203051532.jar" />
	
	<variable name="FRAMEWORK_BUNDLE_LOCATION" value=".$PATHSEP$FrameworkBundles" />
	
	<test id="Test 0: Destroy existing shared class cache" timeout="600" runPath=".">
		<command>$EXE$ $XSHARECLASSES$,destroy</command>
		<output type="success" caseSensitive="yes" regex="no">has been destroyed</output>
		<output type="success" caseSensitive="yes" regex="no">is destroyed</output>
		<output type="success" caseSensitive="yes" regex="no">Cache does not exist</output>
		<output type="failure" caseSensitive="no"  regex="no">Unhandled Exception</output>
		<output type="failure" caseSensitive="yes" regex="no">Exception:</output>
		<output type="failure" caseSensitive="no" regex="no">corrupt</output>
		<output type="failure" caseSensitive="yes" regex="no">Processing dump event</output>
	</test>
	
	<test id="Test 1-a: Create a shared class cache while using weaving hooks" timeout="600" runPath=".">
		<command>$EXE$ $XSHARECLASSES$ -cp $OSGI_CDS_JAR_PATH$ com.ibm.cdsadaptortest.CDSAdaptorOrphanTest -frameworkBundleLocation $FRAMEWORK_BUNDLE_LOCATION$ -testBundleLocation .$PATHSEP$CDSAdaptorOrphanTestBundles</command>
		<output type="success" caseSensitive="no" regex="no">A message from modified class</output>
		<output type="failure" caseSensitive="no" regex="no">original</output>
		<output type="failure" caseSensitive="yes" regex="no">Exception:</output>
		<output type="failure" caseSensitive="yes" regex="no">Processing dump event</output>
	</test>
	
	<test id="Test 1-b: Check shared class cache for presence of Orphan class" timeout="600" runPath=".">
		<command>$EXE$ $XSHARECLASSES$,printStats=orphan+romclass</command>
		<output type="success" caseSensitive="no" regex="no">ORPHAN: com/ibm/testbundle/SomeMessageV1</output>
		<output type="failure" caseSensitive="no" regex="no">ROMCLASS: com/ibm/testbundle/SomeMessageV1</output>
		<output type="failure" caseSensitive="yes" regex="no">Exception:</output>
		<output type="failure" caseSensitive="yes" regex="no">Processing dump event</output>
	</test>
	
	<test id="Test 1-c: Reuse previous cache without using weaving hooks" timeout="600" runPath=".">
		<command>$EXE$ $XSHARECLASSES$ -cp $OSGI_CDS_JAR_PATH$ com.ibm.cdsadaptortest.CDSAdaptorOrphanTest -frameworkBundleLocation $FRAMEWORK_BUNDLE_LOCATION$ -testBundleLocation .$PATHSEP$CDSAdaptorOrphanTestBundles -ignoreWeavingHookBundle</command>
		<output type="success" caseSensitive="no" regex="no">A message from original class</output>
		<output type="failure" caseSensitive="no" regex="no">modified</output>
		<output type="failure" caseSensitive="yes" regex="no">Exception:</output>
		<output type="failure" caseSensitive="yes" regex="no">Processing dump event</output>
	</test>
	
	<test id="Test 1-d: Check shared class cache for presence of ROMClass class" timeout="600" runPath=".">
		<command>$EXE$ $XSHARECLASSES$,printStats=orphan+romclass</command>
		<output type="success" caseSensitive="no" regex="no">ORPHAN: com/ibm/testbundle/SomeMessageV1</output>
		<output type="required" caseSensitive="no" regex="no">ROMCLASS: com/ibm/testbundle/SomeMessageV1</output>
		<output type="failure" caseSensitive="yes" regex="no">Exception:</output>
		<output type="failure" caseSensitive="yes" regex="no">Processing dump event</output>
	</test>
	
	<test id="Test 1-e: Reuse previous cache while using weaving hooks" timeout="600" runPath=".">
		<command>$EXE$ $XSHARECLASSES$ -cp $OSGI_CDS_JAR_PATH$ com.ibm.cdsadaptortest.CDSAdaptorOrphanTest -frameworkBundleLocation $FRAMEWORK_BUNDLE_LOCATION$ -testBundleLocation .$PATHSEP$CDSAdaptorOrphanTestBundles</command>
		<output type="success" caseSensitive="no" regex="no">A message from modified class</output>
		<output type="failure" caseSensitive="no" regex="no">original</output>
		<output type="failure" caseSensitive="yes" regex="no">Exception:</output>
		<output type="failure" caseSensitive="yes" regex="no">Processing dump event</output>
	</test>
	
	<test id="Cleanup: Destroy any existing shared class cache" timeout="600" runPath=".">
		<command>$EXE$ $XSHARECLASSES$,destroy</command>
		<output type="success" caseSensitive="yes" regex="no">has been destroyed</output>
		<output type="success" caseSensitive="yes" regex="no">is destroyed</output>
		<output type="failure" caseSensitive="yes" regex="no">Cache does not exist</output>
		<output type="failure" caseSensitive="no"  regex="no">Unhandled Exception</output>
		<output type="failure" caseSensitive="yes" regex="no">Exception:</output>
		<output type="failure" caseSensitive="no" regex="no">corrupt</output>
		<output type="failure" caseSensitive="yes" regex="no">Processing dump event</output>
	</test>
		
</suite>